#!/bin/bash
# Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
# SPDX-License-Identifier: Apache-2.0

# Bedrock Usage Analyzer - Main CLI entry point

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

# Create virtual environment if it doesn't exist
if [ ! -d "$PROJECT_ROOT/.venv" ]; then
    echo "Creating virtual environment..."
    python3 -m venv "$PROJECT_ROOT/.venv"
    
    # Activate and install package in editable mode
    source "$PROJECT_ROOT/.venv/bin/activate"
    echo "Installing bedrock-usage-analyzer..."
    pip install -e "$PROJECT_ROOT" > /dev/null 2>&1
else
    # Activate existing virtual environment
    source "$PROJECT_ROOT/.venv/bin/activate"
fi

# Run the Python module
python -m bedrock_usage_analyzer analyze "$@"

# Deactivate virtual environment
deactivate
